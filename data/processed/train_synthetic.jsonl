{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classrooms (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, capacity integer); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), classroom_id uuid REFERENCES classrooms(id), event_name text, start_time timestamptz, end_time timestamptz);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a classroom for a workshop on 2024-10-15 from 2 PM to 4 PM.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Basic insert for booking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_classroom_time ON bookings (classroom_id, start_time, end_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Insert booking\",\n      \"sql\": \"INSERT INTO bookings (classroom_id, event_name, start_time, end_time) VALUES ($1, 'Workshop', '2024-10-15 14:00:00'::timestamptz, '2024-10-15 16:00:00'::timestamptz);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE services (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, price numeric(7,2)); CREATE TABLE appointments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, service_id uuid REFERENCES services(id), appointment_time timestamptz); CREATE TABLE slots (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), start_time timestamptz, available boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Book a haircut appointment tomorrow if slot is free.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"insert\",\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Inserted only if no conflicting appointment.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_appointments_time ON appointments (appointment_time);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Conditional insert\",\n      \"sql\": \"INSERT INTO appointments (customer_id, service_id, appointment_time) SELECT $1, $2, $3 WHERE NOT EXISTS (SELECT 1 FROM appointments a WHERE a.appointment_time = $3);\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE classes (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), instructor_id uuid, name text, schedule timestamptz, max_capacity integer); CREATE TABLE enrollments (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), class_id uuid REFERENCES classes(id), student_id uuid);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List gym classes with current enrollment count next week.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and HAVING for filtered counts.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_enrollments_class ON enrollments (class_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Classes with enrollment counts\",\n      \"sql\": \"SELECT c.name, c.schedule, count(e.id) as enrolled FROM classes c LEFT JOIN enrollments e ON c.id = e.class_id WHERE c.schedule >= current_timestamp + interval '1 day' AND c.schedule < current_timestamp + interval '1 week' GROUP BY c.id, c.name, c.schedule HAVING count(e.id) < c.max_capacity;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE tuxedos (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), size text, color text, rental_price numeric(7,2)); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), tuxedo_id uuid REFERENCES tuxedos(id), renter_id uuid, start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Check if a specific tuxedo is available for rental from 2024-11-01 to 2024-11-05.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used OVERLAPS for date range checking.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_tuxedo_dates ON rentals (tuxedo_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Tuxedo availability\",\n      \"sql\": \"SELECT CASE WHEN EXISTS (SELECT 1 FROM rentals r WHERE r.tuxedo_id = $1 AND (r.start_date, r.end_date) OVERLAPS ('2024-11-01'::date, '2024-11-05'::date)) THEN false ELSE true END AS available;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find products by name and category matching a query.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_products_name_category ON products (name, category);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Search products\",\n      \"sql\": \"SELECT p.id, p.name, p.price FROM products p WHERE p.name ILIKE '%keyword%' AND p.category = 'electronics' ORDER BY p.price ASC LIMIT 50;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE venues (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, city text, capacity integer, price_per_hour numeric(10,2)); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), venue_id uuid REFERENCES venues(id), customer_id uuid, booked_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find wedding venues in Jakarta available on 2024-12-15 for 100-200 people.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked availability using NOT EXISTS.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_venues_city_capacity ON venues (city, capacity);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_venue_date ON bookings (venue_id, booked_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available venues\",\n      \"sql\": \"SELECT v.id, v.name FROM venues v WHERE v.city = 'Jakarta' AND v.capacity BETWEEN 100 AND 200 AND NOT EXISTS (SELECT 1 FROM bookings b WHERE b.venue_id = v.id AND b.booked_date = '2024-12-15');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE desks (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), zone text, hourly_rate numeric(5,2)); CREATE TABLE reservations (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), desk_id uuid REFERENCES desks(id), user_id uuid, reserved_date date, start_time time, end_time time);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find free coworking desks in Zone A tomorrow.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Assumed full day booking for simplicity.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_desks_zone ON desks (zone);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_reservations_desk_date ON reservations (desk_id, reserved_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Free desks tomorrow\",\n      \"sql\": \"SELECT d.id, d.hourly_rate FROM desks d WHERE d.zone = 'A' AND NOT EXISTS (SELECT 1 FROM reservations r WHERE r.desk_id = d.id AND r.reserved_date = current_date + interval '1 day');\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a partial index to speed up queries on active products.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Added partial index for active products to improve query performance.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX CONCURRENTLY idx_active_products_name ON products (name) WHERE active = true;\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE villas (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, location text, max_guests integer); CREATE TABLE rentals (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), villa_id uuid REFERENCES villas(id), start_date date, end_date date);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find villas available for booking from 2024-12-20 to 2024-12-25.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Checked for overlaps in rental dates.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_rentals_villa_dates ON rentals (villa_id, start_date, end_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Available villas\",\n      \"sql\": \"SELECT v.id, v.name FROM villas v WHERE v.max_guests >= 4 AND NOT EXISTS (SELECT 1 FROM rentals r WHERE r.villa_id = v.id AND (r.start_date, r.end_date) OVERLAPS ('2024-12-20'::date, '2024-12-25'::date));\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Calculate the total order value for each customer.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used LEFT JOIN and aggregate sum for totals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Customer order totals\",\n      \"sql\": \"SELECT c.name, sum(o.total_amount) as total FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.status = 'completed' GROUP BY c.id, c.name ORDER BY total DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customers (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, active boolean DEFAULT true); CREATE TABLE bookings (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid REFERENCES customers(id), booking_date date, amount numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, total_amount numeric(8,2), status text); CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, active boolean DEFAULT true);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find the last booking per customer using window functions.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\",\n    \"add_indexes\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used ROW_NUMBER window function to rank bookings per customer.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_bookings_customer ON bookings (customer_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Last booking per customer\",\n      \"sql\": \"SELECT id, customer_id, booking_date FROM (SELECT id, customer_id, booking_date, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY booking_date DESC) as rn FROM bookings) sub WHERE rn = 1;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"Find customers with abandoned carts (not updated in the last 7 days).\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_carts_updated ON carts (updated_at);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Abandoned carts with details\",\n      \"sql\": \"SELECT c.customer_id, array_agg(ci.product_id) as product_ids FROM carts c JOIN cart_items ci ON c.id = ci.cart_id WHERE c.updated_at < current_timestamp - interval '7 days' GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE products (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), name text, category text, price numeric(8,2)); CREATE TABLE orders (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, order_date date); CREATE TABLE order_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), order_id uuid REFERENCES orders(id), product_id uuid REFERENCES products(id), quantity integer); CREATE TABLE carts (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), customer_id uuid, updated_at timestamptz); CREATE TABLE cart_items (id uuid PRIMARY KEY DEFAULT gen_random_uuid(), cart_id uuid REFERENCES carts(id), product_id uuid, quantity integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List top 10 best-selling products over the last 90 days.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"select\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Used text search with ILIKE and filtering by category.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_order_items_product ON order_items (product_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_orders_date ON orders (order_date);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Top products by sales\",\n      \"sql\": \"SELECT p.name, sum(oi.quantity) as total_sold FROM products p JOIN order_items oi ON p.id = oi.product_id JOIN orders o ON oi.order_id = o.id WHERE o.order_date >= current_date - interval '90 days' GROUP BY p.id, p.name ORDER BY total_sold DESC LIMIT 10;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
