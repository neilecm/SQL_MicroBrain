{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – Pagila training example\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE film (film_id integer PRIMARY KEY, title varchar); CREATE TABLE film_category (film_id integer REFERENCES film, category_id integer); CREATE TABLE category (category_id integer PRIMARY KEY, name varchar); CREATE TABLE inventory (inventory_id integer PRIMARY KEY, film_id integer REFERENCES film); CREATE TABLE rental (rental_id integer PRIMARY KEY, inventory_id integer REFERENCES inventory);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List all films with their category and the total number of rentals for each.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"write_sql\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Join film to category via film_category, then to rentals via inventory. Use LEFT JOIN and GROUP BY to count rentals per film.\"\n  ],\n  \"indexes\": [],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Retrieve films with category and rental counts\",\n      \"sql\": \"SELECT f.title, c.name AS category, COUNT(r.rental_id) AS total_rentals FROM film f JOIN film_category fc ON f.film_id = fc.film_id JOIN category c ON fc.category_id = c.category_id LEFT JOIN inventory i ON f.film_id = i.film_id LEFT JOIN rental r ON i.inventory_id = r.inventory_id GROUP BY f.film_id, c.category_id ORDER BY total_rentals DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – Pagila training example\n\nUSER_JSON:\n{\n  \"current_schema\": \"\",\n  \"error_message\": \"\",\n  \"mode\": \"optimize_query\",\n  \"natural_language_task\": \"Optimize this query for better performance.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {\n    \"explain_analyze\": \"\",\n    \"problem_query\": \"SELECT f.title, COUNT(r.rental_id) FROM film f, inventory i, rental r WHERE f.film_id = i.film_id AND i.inventory_id = r.inventory_id GROUP BY f.film_id;\"\n  }\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"optimize_query\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Replace implicit JOIN with explicit JOIN for clarity. Add indexes on foreign keys to speed up joins.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_inventory_film_id ON inventory(film_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_rental_inventory_id ON rental(inventory_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Optimized rental count query\",\n      \"sql\": \"SELECT f.title, COUNT(r.rental_id) FROM film f JOIN inventory i ON f.film_id = i.film_id JOIN rental r ON i.inventory_id = r.inventory_id GROUP BY f.film_id, f.title;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – Pagila training example\n\nUSER_JSON:\n{\n  \"current_schema\": \"\",\n  \"error_message\": \"ERROR:  column c.last_nme does not exist\\\\nLINE 1: ...lect c.first_name, c.last_nme, SUM(p.amount) FROM customer c ...\",\n  \"mode\": \"fix_error\",\n  \"natural_language_task\": \"Fix column name error.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {\n    \"explain_analyze\": \"\",\n    \"problem_query\": \"SELECT c.first_name, c.last_nme, SUM(p.amount) FROM customer c JOIN payment p ON c.customer_id = p.customer_id GROUP BY c.customer_id;\"\n  }\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"fix_error\"\n  ],\n  \"error_explanations\": [\n    {\n      \"cause\": \"Typo in column name 'last_nme' instead of 'last_name'\",\n      \"error_message\": \"ERROR:  column c.last_nme does not exist\\\\nLINE 1: ...lect c.first_name, c.last_nme, SUM(p.amount) FROM customer c ...\",\n      \"fix\": \"Change 'last_nme' to 'last_name'\"\n    }\n  ],\n  \"explanations\": [],\n  \"indexes\": [],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Correct column name\",\n      \"sql\": \"SELECT c.first_name, c.last_name, SUM(p.amount) FROM customer c JOIN payment p ON c.customer_id = p.customer_id GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – Pagila training example\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customer (customer_id integer PRIMARY KEY, first_name varchar, last_name varchar);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a loyalty points system for customers.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"design_schema\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Add points table linked to customers, with example query to award based on recent rentals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_loyalty_customer_id ON loyalty_points(customer_id);\"\n    }\n  ],\n  \"migrations\": [\n    {\n      \"filename\": \"001_add_loyalty_points_table.sql\",\n      \"sql\": \"CREATE TABLE loyalty_points (id SERIAL PRIMARY KEY, customer_id integer REFERENCES customer(customer_id), points integer DEFAULT 0, earned_date date DEFAULT CURRENT_DATE);\"\n    }\n  ],\n  \"queries\": [\n    {\n      \"description\": \"Award loyalty points for rentals\",\n      \"sql\": \"INSERT INTO loyalty_points (customer_id, points) SELECT r.customer_id, COUNT(*) * 10 FROM rental r WHERE r.return_date IS NOT NULL AND r.return_date >= CURRENT_DATE - INTERVAL '1 month' GROUP BY r.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – Pagila training example\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE rental (rental_id integer PRIMARY KEY, inventory_id integer); CREATE TABLE staff (staff_id integer PRIMARY KEY, store_id integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_rls\",\n  \"natural_language_task\": \"Staff should only see rentals from their own store.\",\n  \"preferences\": {\n    \"db_engine\": \"supabase\",\n    \"supabase_style\": true\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"design_rls\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Use RLS to restrict rentals to those in staff's store via inventory.\"\n  ],\n  \"indexes\": [],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [\n    {\n      \"on_table\": \"rental\",\n      \"policy_name\": \"staff_store_isolation\",\n      \"sql\": \"CREATE POLICY staff_store_isolation ON rental FOR ALL USING (inventory_id IN (SELECT inventory_id FROM inventory WHERE store_id = (SELECT store_id FROM staff WHERE staff_id = auth.uid())));\"\n    }\n  ],\n  \"safe_to_execute\": true\n}"}
