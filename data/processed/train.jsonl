{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – Pagila training example\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE film (film_id integer PRIMARY KEY, title varchar); CREATE TABLE film_category (film_id integer REFERENCES film, category_id integer); CREATE TABLE category (category_id integer PRIMARY KEY, name varchar); CREATE TABLE inventory (inventory_id integer PRIMARY KEY, film_id integer REFERENCES film); CREATE TABLE rental (rental_id integer PRIMARY KEY, inventory_id integer REFERENCES inventory);\",\n  \"error_message\": \"\",\n  \"mode\": \"write_sql\",\n  \"natural_language_task\": \"List all films with their category and the total number of rentals for each.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"write_sql\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Join film to category via film_category, then to rentals via inventory. Use LEFT JOIN and GROUP BY to count rentals per film.\"\n  ],\n  \"indexes\": [],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Retrieve films with category and rental counts\",\n      \"sql\": \"SELECT f.title, c.name AS category, COUNT(r.rental_id) AS total_rentals FROM film f JOIN film_category fc ON f.film_id = fc.film_id JOIN category c ON fc.category_id = c.category_id LEFT JOIN inventory i ON f.film_id = i.film_id LEFT JOIN rental r ON i.inventory_id = r.inventory_id GROUP BY f.film_id, c.category_id ORDER BY total_rentals DESC;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – Pagila training example\n\nUSER_JSON:\n{\n  \"current_schema\": \"\",\n  \"error_message\": \"\",\n  \"mode\": \"optimize_query\",\n  \"natural_language_task\": \"Optimize this query for better performance.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {\n    \"explain_analyze\": \"\",\n    \"problem_query\": \"SELECT f.title, COUNT(r.rental_id) FROM film f, inventory i, rental r WHERE f.film_id = i.film_id AND i.inventory_id = r.inventory_id GROUP BY f.film_id;\"\n  }\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"optimize_query\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Replace implicit JOIN with explicit JOIN for clarity. Add indexes on foreign keys to speed up joins.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_inventory_film_id ON inventory(film_id);\"\n    },\n    {\n      \"sql\": \"CREATE INDEX idx_rental_inventory_id ON rental(inventory_id);\"\n    }\n  ],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Optimized rental count query\",\n      \"sql\": \"SELECT f.title, COUNT(r.rental_id) FROM film f JOIN inventory i ON f.film_id = i.film_id JOIN rental r ON i.inventory_id = r.inventory_id GROUP BY f.film_id, f.title;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – Pagila training example\n\nUSER_JSON:\n{\n  \"current_schema\": \"\",\n  \"error_message\": \"ERROR:  column c.last_nme does not exist\\\\nLINE 1: ...lect c.first_name, c.last_nme, SUM(p.amount) FROM customer c ...\",\n  \"mode\": \"fix_error\",\n  \"natural_language_task\": \"Fix column name error.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {\n    \"explain_analyze\": \"\",\n    \"problem_query\": \"SELECT c.first_name, c.last_nme, SUM(p.amount) FROM customer c JOIN payment p ON c.customer_id = p.customer_id GROUP BY c.customer_id;\"\n  }\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"fix_error\"\n  ],\n  \"error_explanations\": [\n    {\n      \"cause\": \"Typo in column name 'last_nme' instead of 'last_name'\",\n      \"error_message\": \"ERROR:  column c.last_nme does not exist\\\\nLINE 1: ...lect c.first_name, c.last_nme, SUM(p.amount) FROM customer c ...\",\n      \"fix\": \"Change 'last_nme' to 'last_name'\"\n    }\n  ],\n  \"explanations\": [],\n  \"indexes\": [],\n  \"migrations\": [],\n  \"queries\": [\n    {\n      \"description\": \"Correct column name\",\n      \"sql\": \"SELECT c.first_name, c.last_name, SUM(p.amount) FROM customer c JOIN payment p ON c.customer_id = p.customer_id GROUP BY c.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – Pagila training example\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE customer (customer_id integer PRIMARY KEY, first_name varchar, last_name varchar);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_schema\",\n  \"natural_language_task\": \"Add a loyalty points system for customers.\",\n  \"preferences\": {\n    \"db_engine\": \"postgres\",\n    \"naming\": \"snake_case\",\n    \"supabase_style\": false\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"design_schema\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Add points table linked to customers, with example query to award based on recent rentals.\"\n  ],\n  \"indexes\": [\n    {\n      \"sql\": \"CREATE INDEX idx_loyalty_customer_id ON loyalty_points(customer_id);\"\n    }\n  ],\n  \"migrations\": [\n    {\n      \"filename\": \"001_add_loyalty_points_table.sql\",\n      \"sql\": \"CREATE TABLE loyalty_points (id SERIAL PRIMARY KEY, customer_id integer REFERENCES customer(customer_id), points integer DEFAULT 0, earned_date date DEFAULT CURRENT_DATE);\"\n    }\n  ],\n  \"queries\": [\n    {\n      \"description\": \"Award loyalty points for rentals\",\n      \"sql\": \"INSERT INTO loyalty_points (customer_id, points) SELECT r.customer_id, COUNT(*) * 10 FROM rental r WHERE r.return_date IS NOT NULL AND r.return_date >= CURRENT_DATE - INTERVAL '1 month' GROUP BY r.customer_id;\"\n    }\n  ],\n  \"rls_policies\": [],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – Pagila training example\n\nUSER_JSON:\n{\n  \"current_schema\": \"CREATE TABLE rental (rental_id integer PRIMARY KEY, inventory_id integer); CREATE TABLE staff (staff_id integer PRIMARY KEY, store_id integer);\",\n  \"error_message\": \"\",\n  \"mode\": \"design_rls\",\n  \"natural_language_task\": \"Staff should only see rentals from their own store.\",\n  \"preferences\": {\n    \"db_engine\": \"supabase\",\n    \"supabase_style\": true\n  },\n  \"sql_snippets\": {}\n}\n\nASSISTANT_JSON:\n", "completion": "{\n  \"actions\": [\n    \"design_rls\"\n  ],\n  \"error_explanations\": [],\n  \"explanations\": [\n    \"Use RLS to restrict rentals to those in staff's store via inventory.\"\n  ],\n  \"indexes\": [],\n  \"migrations\": [],\n  \"queries\": [],\n  \"rls_policies\": [\n    {\n      \"on_table\": \"rental\",\n      \"policy_name\": \"staff_store_isolation\",\n      \"sql\": \"CREATE POLICY staff_store_isolation ON rental FOR ALL USING (inventory_id IN (SELECT inventory_id FROM inventory WHERE store_id = (SELECT store_id FROM staff WHERE staff_id = auth.uid())));\"\n    }\n  ],\n  \"safe_to_execute\": true\n}"}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"write_sql\\\", \\\"natural_language_task\\\": \\\"List all active services for a specific tenant\\\", \\\"current_schema\\\": \\\"CREATE TABLE tenant (tenant_id uuid PRIMARY KEY, name text); CREATE TABLE service (service_id uuid PRIMARY KEY, tenant_id uuid REFERENCES tenant(tenant_id), name text, is_active boolean DEFAULT true);\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"supabase\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": true}, \\\"sql_snippets\\\": {}, \\\"error_message\\\": \\\"\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"write_sql\\\"], \\\"migrations\\\": [], \\\"rls_policies\\\": [], \\\"indexes\\\": [], \\\"queries\\\": [{\\\"description\\\": \\\"Active services by tenant\\\", \\\"sql\\\": \\\"SELECT service_id, name FROM service WHERE tenant_id = $1 AND is_active = true ORDER BY name;\\\"}], \\\"error_explanations\\\": [], \\\"explanations\\\": [\\\"Filter services by active status and tenant\\\"], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"write_sql\\\", \\\"natural_language_task\\\": \\\"Find upcoming bookings for the next 7 days for a tenant\\\", \\\"current_schema\\\": \\\"CREATE TABLE tenant (tenant_id uuid PRIMARY KEY); CREATE TABLE booking (booking_id uuid PRIMARY KEY, tenant_id uuid REFERENCES tenant(tenant_id), customer_id uuid REFERENCES app_user(user_id), starts_at timestamptz, status text); CREATE TABLE app_user (user_id uuid PRIMARY KEY, full_name text);\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"supabase\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": true}, \\\"sql_snippets\\\": {}, \\\"error_message\\\": \\\"\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"write_sql\\\"], \\\"migrations\\\": [], \\\"rls_policies\\\": [], \\\"indexes\\\": [], \\\"queries\\\": [{\\\"description\\\": \\\"Upcoming bookings within 7 days\\\", \\\"sql\\\": \\\"SELECT b.booking_id, u.full_name, b.starts_at FROM booking b JOIN app_user u ON b.customer_id = u.user_id WHERE b.tenant_id = $1 AND b.starts_at BETWEEN now() AND now() + interval '7 days' AND b.status = 'confirmed' ORDER BY b.starts_at;\\\"}], \\\"error_explanations\\\": [], \\\"explanations\\\": [\\\"Date range filter on future confirmed bookings\\\"], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"write_sql\\\", \\\"natural_language_task\\\": \\\"Calculate total revenue per service for the last month\\\", \\\"current_schema\\\": \\\"CREATE TABLE service (service_id uuid PRIMARY KEY, name text); CREATE TABLE booking (booking_id uuid PRIMARY KEY, service_id uuid REFERENCES service(service_id), status text); CREATE TABLE payment (payment_id uuid PRIMARY KEY, booking_id uuid REFERENCES booking(booking_id), amount numeric(12,2), status text, created_at timestamptz);\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"postgres\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": false}, \\\"sql_snippets\\\": {}, \\\"error_message\\\": \\\"\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"write_sql\\\"], \\\"migrations\\\": [], \\\"rls_policies\\\": [], \\\"indexes\\\": [], \\\"queries\\\": [{\\\"description\\\": \\\"Monthly revenue by service\\\", \\\"sql\\\": \\\"SELECT s.name AS service_name, SUM(p.amount) AS total_revenue FROM service s JOIN booking b ON s.service_id = b.service_id JOIN payment p ON b.booking_id = p.booking_id WHERE p.status = 'paid' AND p.created_at >= date_trunc('month', now() - interval '1 month') AND p.created_at < date_trunc('month', now()) GROUP BY s.service_id, s.name ORDER BY total_revenue DESC;\\\"}], \\\"error_explanations\\\": [], \\\"explanations\\\": [\\\"Join services, bookings, payments with monthly date filter\\\"], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"write_sql\\\", \\\"natural_language_task\\\": \\\"List rental orders that have overdue items\\\", \\\"current_schema\\\": \\\"CREATE TABLE rental_order (rental_order_id uuid PRIMARY KEY, customer_id uuid REFERENCES app_user(user_id), status text, event_date date); CREATE TABLE rental_order_item (rental_order_item_id uuid PRIMARY KEY, rental_order_id uuid REFERENCES rental_order(rental_order_id), rental_end_date date); CREATE TABLE app_user (user_id uuid PRIMARY KEY, full_name text);\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"postgres\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": false}, \\\"sql_snippets\\\": {}, \\\"error_message\\\": \\\"\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"write_sql\\\"], \\\"migrations\\\": [], \\\"rls_policies\\\": [], \\\"indexes\\\": [], \\\"queries\\\": [{\\\"description\\\": \\\"Overdue rental orders\\\", \\\"sql\\\": \\\"SELECT o.rental_order_id, u.full_name, o.event_date FROM rental_order o JOIN app_user u ON o.customer_id = u.user_id WHERE o.status = 'confirmed' AND EXISTS (SELECT 1 FROM rental_order_item i WHERE i.rental_order_id = o.rental_order_id AND i.rental_end_date < CURRENT_DATE) ORDER BY o.event_date;\\\"}], \\\"error_explanations\\\": [], \\\"explanations\\\": [\\\"Check for items where end date has passed\\\"], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"write_sql\\\", \\\"natural_language_task\\\": \\\"Show resource utilization rate (hours booked / total available hours)\\\", \\\"current_schema\\\": \\\"CREATE TABLE resource (resource_id uuid PRIMARY KEY, name text, capacity integer); CREATE TABLE availability_slot (slot_id uuid PRIMARY KEY, resource_id uuid REFERENCES resource(resource_id), start_time timestamptz, end_time timestamptz); CREATE TABLE booking (booking_id uuid PRIMARY KEY, resource_id uuid REFERENCES resource(resource_id), starts_at timestamptz, ends_at timestamptz, status text);\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"postgres\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": false}, \\\"sql_snippets\\\": {}, \\\"error_message\\\": \\\"\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"write_sql\\\"], \\\"migrations\\\": [], \\\"rls_policies\\\": [], \\\"indexes\\\": [], \\\"queries\\\": [{\\\"description\\\": \\\"Resource utilization rates\\\", \\\"sql\\\": \\\"SELECT r.name, r.capacity, COUNT(b.booking_id) AS bookings, SUM(EXTRACT(epoch FROM (b.ends_at - b.starts_at))/3600) AS booked_hours, SUM(EXTRACT(epoch FROM (a.end_time - a.start_time))/3600) AS total_available_hours, (SUM(EXTRACT(epoch FROM (b.ends_at - b.starts_at))/3600) / NULLIF(SUM(EXTRACT(epoch FROM (a.end_time - a.start_time))/3600), 0)) * 100 AS utilization_percent FROM resource r LEFT JOIN availability_slot a ON r.resource_id = a.resource_id LEFT JOIN booking b ON r.resource_id = b.resource_id AND b.status = 'confirmed' AND b.starts_at >= CURRENT_DATE AND b.starts_at < CURRENT_DATE + INTERVAL '1 month' GROUP BY r.resource_id, r.name, r.capacity ORDER BY utilization_percent DESC;\\\"}], \\\"error_explanations\\\": [], \\\"explanations\\\": [\\\"Calculate booked hours vs total available hours\\\"], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"write_sql\\\", \\\"natural_language_task\\\": \\\"List customers who booked more than 3 classes this month\\\", \\\"current_schema\\\": \\\"CREATE TABLE app_user (user_id uuid PRIMARY KEY, full_name text); CREATE TABLE service (service_id uuid PRIMARY KEY, service_type text); CREATE TABLE booking (booking_id uuid PRIMARY KEY, customer_id uuid REFERENCES app_user(user_id), service_id uuid REFERENCES service(service_id), starts_at timestamptz, status text);\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"postgres\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": false}, \\\"sql_snippets\\\": {}, \\\"error_message\\\": \\\"\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"write_sql\\\"], \\\"migrations\\\": [], \\\"rls_policies\\\": [], \\\"indexes\\\": [], \\\"queries\\\": [{\\\"description\\\": \\\"Active class bookers this month\\\", \\\"sql\\\": \\\"SELECT u.full_name, u.user_id, COUNT(b.booking_id) AS class_count FROM app_user u JOIN booking b ON u.user_id = b.customer_id JOIN service s ON b.service_id = s.service_id WHERE s.service_type = 'class' AND b.status = 'confirmed' AND b.starts_at >= date_trunc('month', CURRENT_DATE) GROUP BY u.user_id, u.full_name HAVING COUNT(b.booking_id) > 3 ORDER BY class_count DESC;\\\"}], \\\"error_explanations\\\": [], \\\"explanations\\\": [\\\"Filter by class type and count bookings with HAVING clause\\\"], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"write_sql\\\", \\\"natural_language_task\\\": \\\"Find products available for rental in wedding dresses category\\\", \\\"current_schema\\\": \\\"CREATE TABLE product (product_id uuid PRIMARY KEY, category text, is_active boolean); CREATE TABLE product_inventory (inventory_id uuid PRIMARY KEY, product_id uuid REFERENCES product(product_id), is_available boolean);\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"supabase\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": true}, \\\"sql_snippets\\\": {}, \\\"error_message\\\": \\\"\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"write_sql\\\"], \\\"migrations\\\": [], \\\"rls_policies\\\": [], \\\"indexes\\\": [], \\\"queries\\\": [{\\\"description\\\": \\\"Available wedding dresses\\\", \\\"sql\\\": \\\"SELECT DISTINCT p.product_id, i.inventory_id FROM product p JOIN product_inventory i ON p.product_id = i.product_id WHERE p.category = 'wedding_dress' AND p.is_active = true AND i.is_available = true;\\\"}], \\\"error_explanations\\\": [], \\\"explanations\\\": [\\\"Join products to inventory with category andavailability filters\\\"], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"write_sql\\\", \\\"natural_language_task\\\": \\\"Show pending payments for a customer\\\", \\\"current_schema\\\": \\\"CREATE TABLE app_user (user_id uuid PRIMARY KEY, full_name text); CREATE TABLE booking (booking_id uuid PRIMARY KEY, customer_id uuid REFERENCES app_user(user_id)); CREATE TABLE payment (payment_id uuid PRIMARY KEY, booking_id uuid REFERENCES booking(booking_id), amount numeric(12,2), currency char(3), status text);\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"supabase\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": true}, \\\"sql_snippets\\\": {}, \\\"error_message\\\": \\\"\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"write_sql\\\"], \\\"migrations\\\": [], \\\"rls_policies\\\": [], \\\"indexes\\\": [], \\\"queries\\\": [{\\\"description\\\": \\\"Pending customer payments\\\", \\\"sql\\\": \\\"SELECT p.amount, p.currency, p.created_at FROM payment p JOIN booking b ON p.booking_id = b.booking_id WHERE b.customer_id = $1 AND p.status = 'pending' ORDER BY p.created_at DESC;\\\"}], \\\"error_explanations\\\": [], \\\"explanations\\\": [\\\"Filter payments by status and customer\\\"], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"write_sql\\\", \\\"natural_language_task\\\": \\\"List services with their average booking duration\\\", \\\"current_schema\\\": \\\"CREATE TABLE service (service_id uuid PRIMARY KEY, name text, duration_minutes integer); CREATE TABLE booking (booking_id uuid PRIMARY KEY, service_id uuid REFERENCES service(service_id), starts_at timestamptz, ends_at timestamptz, status text);\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"postgres\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": false}, \\\"sql_snippets\\\": {}, \\\"error_message\\\": \\\"\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"write_sql\\\"], \\\"migrations\\\": [], \\\"rls_policies\\\": [], \\\"indexes\\\": [], \\\"queries\\\": [{\\\"description\\\": \\\"Average booking duration by service\\\", \\\"sql\\\": \\\"SELECT s.name, s.duration_minutes AS configured_duration, AVG(EXTRACT(epoch FROM (b.ends_at - b.starts_at))/60) AS average_booked_duration FROM service s LEFT JOIN booking b ON s.service_id = b.service_id AND b.status = 'completed' GROUP BY s.service_id, s.name, s.duration_minutes ORDER BY average_booked_duration;\\\"}], \\\"error_explanations\\\": [], \\\"explanations\\\": [\\\"Average actual vs configured service duration\\\"], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"write_sql\\\", \\\"natural_language_task\\\": \\\"Find staff members handling the most bookings\\\", \\\"current_schema\\\": \\\"CREATE TABLE app_user (user_id uuid PRIMARY KEY, full_name text, role text); CREATE TABLE booking (booking_id uuid PRIMARY KEY, staff_id uuid REFERENCES app_user(user_id), status text);\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"postgres\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": false}, \\\"sql_snippets\\\": {}, \\\"error_message\\\": \\\"\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"write_sql\\\"], \\\"migrations\\\": [], \\\"rls_policies\\\": [], \\\"indexes\\\": [], \\\"queries\\\": [{\\\"description\\\": \\\"Booking counts by staff\\\", \\\"sql\\\": \\\"SELECT u.full_name, u.role, COUNT(b.booking_id) AS booking_count FROM app_user u LEFT JOIN booking b ON u.user_id = b.staff_id AND b.status IN ('confirmed', 'completed') WHERE u.role = 'staff' GROUP BY u.user_id, u.full_name, u.role ORDER BY booking_count DESC;\\\"}], \\\"error_explanations\\\": [], \\\"explanations\\\": [\\\"Count confirmed and completed bookings by staff\\\"], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"optimize_query\\\", \\\"natural_language_task\\\": \\\"Improve this slow booking search query\\\", \\\"current_schema\\\": \\\"\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"postgres\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": false}, \\\"sql_snippets\\\": {\\\"problem_query\\\": \\\"SELECT * FROM booking WHERE starts_at > '2024-01-01' AND status = 'confirmed';\\\"}, \\\"error_message\\\": \\\"\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"optimize_query\\\"], \\\"migrations\\\": [], \\\"rls_policies\\\": [], \\\"indexes\\\": [], \\\"queries\\\": [], \\\"error_explanations\\\": [], \\\"explanations\\\": [\\\"Add compound index on date filter and status columns\\\"], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"optimize_query\\\", \\\"natural_language_task\\\": \\\"Speed up customer payment lookup\\\", \\\"current_schema\\\": \\\"\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"postgres\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": false}, \\\"sql_snippets\\\": {\\\"problem_query\\\": \\\"SELECT u.full_name, SUM(p.amount) FROM app_user u JOIN booking b ON u.user_id = b.customer_id JOIN payment p ON b.booking_id = p.booking_id WHERE u.email = 'customer@example.com' AND p.status = 'paid' GROUP BY u.user_id, u.full_name;\\\", \\\"explain_analyze\\\": \\\"Seq Scan on app_user (cost=0.00..8.00 rows=1 width=100) (actual time=0.010..0.012 rows=1 loops=1)\\\\n  Filter: (email = 'customer@example.com'::text)\\\"}, \\\"error_message\\\": \\\"\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"optimize_query\\\"], \\\"migrations\\\": [], \\\"rls_policies\\\": [], \\\"indexes\\\": [{\\\"sql\\\": \\\"CREATE UNIQUE INDEX idx_user_email ON app_user(email);\\\"}, {\\\"sql\\\": \\\"CREATE INDEX idx_payment_booking_status ON payment(booking_id, status);\\\"}], \\\"queries\\\": [], \\\"error_explanations\\\": [], \\\"explanations\\\": [\\\"Add unique email index for lookups, compound index for payment filtering\\\"], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"optimize_query\\\", \\\"natural_language_task\\\": \\\"Make this product search faster\\\", \\\"current_schema\\\": \\\"\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"postgres\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": false}, \\\"sql_snippets\\\": {\\\"problem_query\\\": \\\"SELECT * FROM product WHERE category = 'wedding_dress' AND is_active = true;\\\"}, \\\"error_message\\\": \\\"\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"optimize_query\\\"], \\\"migrations\\\": [], \\\"rls_policies\\\": [], \\\"indexes\\\": [{\\\"sql\\\": \\\"CREATE INDEX idx_product_category_active ON product(category, is_active);\\\"}], \\\"queries\\\": [], \\\"error_explanations\\\": [], \\\"explanations\\\": [\\\"Compound index for category and active filter\\\"], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"optimize_query\\\", \\\"natural_language_task\\\": \\\"Optimize this rental availability check\\\", \\\"current_schema\\\": \\\"\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"postgres\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": false}, \\\"sql_snippets\\\": {\\\"problem_query\\\": \\\"SELECT i.inventory_id FROM product_inventory i WHERE i.is_available = true AND i.product_id = '123e4567-e89b-12d3-a456-426614174000';\\\"}, \\\"error_message\\\": \\\"\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"optimize_query\\\"], \\\"migrations\\\": [], \\\"rls_policies\\\": [], \\\"indexes\\\": [{\\\"sql\\\": \\\"CREATE INDEX idx_inventory_product_available ON product_inventory(product_id, is_available);\\\"}], \\\"queries\\\": [], \\\"error_explanations\\\": [], \\\"explanations\\\": [\\\"Index on product_id and available flag for quick lookups\\\"], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"optimize_query\\\", \\\"natural_language_task\\\": \\\"Improve this complex service booker query\\\", \\\"current_schema\\\": \\\"\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"postgres\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": false}, \\\"sql_snippets\\\": {\\\"problem_query\\\": \\\"SELECT s.name, COUNT(b.booking_id) FROM service s JOIN booking b ON s.service_id = b.service_id JOIN payment p ON b.booking_id = p.booking_id WHERE p.status = 'paid' AND b.starts_at >= CURRENT_DATE - INTERVAL '6 months' GROUP BY s.service_id, s.name ORDER BY COUNT(b.booking_id) DESC;\\\", \\\"explain_analyze\\\": \\\"HashAggregate (cost=1000.00..1005.00 rows=10 width=40) (actual time=50.000..50.050 rows=5 loops=1)\\\\n  Group Key: s.service_id, s.name\\\\n  ->  Hash Join (cost=500.00..999.00 rows=200 width=80) (actual time=40.000..49.500 rows=120 loops=1)\\\"}, \\\"error_message\\\": \\\"\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"optimize_query\\\"], \\\"migrations\\\": [], \\\"rls_policies\\\": [], \\\"indexes\\\": [{\\\"sql\\\": \\\"CREATE INDEX idx_booking_service_starts ON booking(service_id, starts_at);\\\"}, {\\\"sql\\\": \\\"CREATE INDEX idx_payment_booking_status ON payment(booking_id, status);\\\"}], \\\"queries\\\": [{\\\"description\\\": \\\"Optimized service popularity query\\\", \\\"sql\\\": \\\"SELECT s.name, COUNT(b.booking_id) FROM service s JOIN booking b ON s.service_id = b.service_id JOIN payment p ON b.booking_id = p.booking_id WHERE p.status = 'paid' AND b.starts_at >= CURRENT_DATE - INTERVAL '6 months' GROUP BY s.service_id, s.name ORDER BY COUNT(b.booking_id) DESC LIMIT 10;\\\"}], \\\"error_explanations\\\": [], \\\"explanations\\\": [\\\"Add indexes on join columns, LIMIT results to avoid over-processing\\\"], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"optimize_query\\\", \\\"natural_language_task\\\": \\\"Speed up tenant data queries\\\", \\\"current_schema\\\": \\\"\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"postgres\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": false}, \\\"sql_snippets\\\": {\\\"problem_query\\\": \\\"SELECT COUNT(*) FROM booking WHERE tenant_id = '12345678-1234-1234-1234-123456789abc';\\\"}, \\\"error_message\\\": \\\"\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"optimize_query\\\"], \\\"migrations\\\": [], \\\"rls_policies\\\": [], \\\"indexes\\\": [{\\\"sql\\\": \\\"CREATE INDEX idx_booking_tenant ON booking(tenant_id);\\\"}, {\\\"sql\\\": \\\"CREATE INDEX idx_service_tenant ON service(tenant_id);\\\"}, {\\\"sql\\\": \\\"CREATE INDEX idx_resource_tenant ON resource(tenant_id);\\\"}], \\\"queries\\\": [], \\\"error_explanations\\\": [], \\\"explanations\\\": [\\\"Add tenant_id indexes for multi-tenant data isolation\\\"], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"fix_error\\\", \\\"natural_language_task\\\": \\\"Fix this GROUP BY error\\\", \\\"current_schema\\\": \\\"\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"postgres\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": false}, \\\"sql_snippets\\\": {\\\"problem_query\\\": \\\"SELECT u.full_name, COUNT(b.booking_id) FROM app_user u LEFT JOIN booking b ON u.user_id = b.customer_id GROUP BY u.user_id;\\\"}, \\\"error_message\\\": \\\"ERROR:  column \\\\\\\"u.full_name\\\\\\\" must appear in the GROUP BY clause or be used in an aggregate function\\\\nLINE 1: SELECT u.full_name, COUNT(b.booking_id) FROM app_user u LEFT J...\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"fix_error\\\"], \\\"migrations\\\": [], \\\"rls_policies\\\": [], \\\"indexes\\\": [], \\\"queries\\\": [{\\\"description\\\": \\\"Fixed GROUP BY query\\\", \\\"sql\\\": \\\"SELECT u.full_name, COUNT(b.booking_id) FROM app_user u LEFT JOIN booking b ON u.user_id = b.customer_id GROUP BY u.user_id, u.full_name;\\\"}], \\\"error_explanations\\\": [{\\\"error_message\\\": \\\"ERROR:  column \\\\\\\"u.full_name\\\\\\\" must appear in the GROUP BY clause or be used in an aggregate function\\\", \\\"cause\\\": \\\"Non-aggregated column in SELECT not included in GROUP BY\\\", \\\"fix\\\": \\\"Add u.full_name to GROUP BY clause\\\"}], \\\"explanations\\\": [], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"fix_error\\\", \\\"natural_language_task\\\": \\\"Use correct function name\\\", \\\"current_schema\\\": \\\"\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"postgres\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": false}, \\\"sql_snippets\\\": {\\\"problem_query\\\": \\\"SELECT booking_id, IFNULL(payment_id, 'Unpaid') FROM booking LEFT JOIN payment ON booking.booking_id = payment.booking_id;\\\"}, \\\"error_message\\\": \\\"ERROR:  function ifnull(unknown, unknown) does not exist\\\\nLINE 1: ...booking_id, IFNULL(payment_id, 'Unpaid') FROM booking LEFT JO...\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"fix_error\\\"], \\\"migrations\\\": [], \\\"rls_policies\\\": [], \\\"indexes\\\": [], \\\"queries\\\": [{\\\"description\\\": \\\"Use COALESCE instead of IFNULL\\\", \\\"sql\\\": \\\"SELECT booking_id, COALESCE(payment_id, 'Unpaid') FROM booking LEFT JOIN payment ON booking.booking_id = payment.booking_id;\\\"}], \\\"error_explanations\\\": [{\\\"error_message\\\": \\\"ERROR:  function ifnull(unknown, unknown) does not exist\\\", \\\"cause\\\": \\\"IFNULL is MySQL syntax, not PostgreSQL\\\", \\\"fix\\\": \\\"Use COALESCE for PostgreSQL null handling\\\"}], \\\"explanations\\\": [], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"fix_error\\\", \\\"natural_language_task\\\": \\\"Fix invalid enum value\\\", \\\"current_schema\\\": \\\"\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"postgres\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": false}, \\\"sql_snippets\\\": {\\\"problem_query\\\": \\\"UPDATE booking SET status = 'approved' WHERE booking_id = '12345678-1234-1234-1234-123456789abc';\\\"}, \\\"error_message\\\": \\\"ERROR:  new row for relation \\\\\\\"booking\\\\\\\" violates check constraint \\\\\\\"booking_status_check\\\\\\\"\\\\nDETAIL:  Failing row contains (approved)\\\\\\\" marked invalid.\\\\nLINE 1: UPDATE booking SET status = 'approved' WHERE booking_id = '123...\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"fix_error\\\"], \\\"migrations\\\": [], \\\"rls_policies\\\": [], \\\"indexes\\\": [], \\\"queries\\\": [{\\\"description\\\": \\\"Use valid status value\\\", \\\"sql\\\": \\\"UPDATE booking SET status = 'confirmed' WHERE booking_id = '12345678-1234-1234-1234-123456789abc';\\\"}], \\\"error_explanations\\\": [{\\\"error_message\\\": \\\"ERROR:  new row for relation \\\\\\\"booking\\\\\\\" violates check constraint \\\\\\\"booking_status_check\\\\\\\"\\\", \\\"cause\\\": \\\"'approved' is not a valid status enum value\\\", \\\"fix\\\": \\\"Use 'confirmed' which is an allowed status\\\"}], \\\"explanations\\\": [], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"fix_error\\\", \\\"natural_language_task\\\": \\\"Fix foreign key violation\\\", \\\"current_schema\\\": \\\"\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"postgres\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": false}, \\\"sql_snippets\\\": {\\\"problem_query\\\": \\\"INSERT INTO booking (booking_id, tenant_id, service_id) VALUES ('12345678-1234-1234-1234-123456789abc', 'invalid-uuid', 'some-service-id');\\\"}, \\\"error_message\\\": \\\"ERROR:  insert or update on table \\\\\\\"booking\\\\\\\" violates foreign key constraint \\\\\\\"booking_tenant_id_fkey\\\\\\\"\\\\n DETAIL:  Key (tenant_id)=(invalid-uuid) is not present in table \\\\\\\"tenant\\\\\\\".\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"fix_error\\\"], \\\"migrations\\\": [], \\\"rls_policies\\\": [], \\\"indexes\\\": [], \\\"queries\\\": [{\\\"description\\\": \\\"Use existing tenant_id\\\", \\\"sql\\\": \\\"INSERT INTO booking (booking_id, tenant_id, service_id) VALUES ('12345678-1234-1234-1234-123456789abc', (SELECT tenant_id FROM tenant LIMIT 1), 'some-service-id');\\\"}], \\\"error_explanations\\\": [{\\\"error_message\\\": \\\"ERROR:  insert or update on table \\\\\\\"booking\\\\\\\" violates foreign key constraint \\\\\\\"booking_tenant_id_fkey\\\\\\\"\\\", \\\"cause\\\": \\\"Parent record (tenant) with invalid UUID does not exist\\\", \\\"fix\\\": \\\"Use an existing tenant_id from the database\\\"}], \\\"explanations\\\": [], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"fix_error\\\", \\\"natural_language_task\\\": \\\"Fix date format error\\\", \\\"current_schema\\\": \\\"\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"postgres\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": false}, \\\"sql_snippets\\\": {\\\"problem_query\\\": \\\"INSERT INTO availability_slot (slot_id, start_time) VALUES ('12345678-1234-1234-1234-123456789abc', '2024/01/01 10:00 AM');\\\"}, \\\"error_message\\\": \\\"ERROR:  date/time field value out of range: \\\\\\\"2024/01/01 10:00 AM\\\\\\\"\\\\nHINT:  Perhaps you need a different \\\\\\\"datestyle\\\\\\\" setting.\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"fix_error\\\"], \\\"migrations\\\": [], \\\"rls_policies\\\": [], \\\"indexes\\\": [], \\\"queries\\\": [{\\\"description\\\": \\\"Use ISO date format\\\", \\\"sql\\\": \\\"INSERT INTO availability_slot (slot_id, start_time) VALUES ('12345678-1234-1234-1234-123456789abc', '2024-01-01 10:00:00'::timestamp);\\\"}], \\\"error_explanations\\\": [{\\\"error_message\\\": \\\"ERROR:  date/time field value out of range: \\\\\\\"2024/01/01 10:00 AM\\\\\\\"\\\", \\\"cause\\\": \\\"Date format not recognized by PostgreSQL\\\", \\\"fix\\\": \\\"Use ISO format: '2024-01-01 10:00:00'\\\"}], \\\"explanations\\\": [], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"fix_error\\\", \\\"natural_language_task\\\": \\\"Fix wrong table name\\\", \\\"current_schema\\\": \\\"\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"postgres\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": false}, \\\"sql_snippets\\\": {\\\"problem_query\\\": \\\"SELECT * FROM users WHERE email = 'test@example.com';\\\"}, \\\"error_message\\\": \\\"ERROR:  relation \\\\\\\"users\\\\\\\" does not exist\\\\nLINE 1: SELECT * FROM users WHERE email = 'test@example.com';\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"fix_error\\\"], \\\"migrations\\\": [], \\\"rls_policies\\\": [], \\\"indexes\\\": [], \\\"queries\\\": [{\\\"description\\\": \\\"Use correct table name\\\", \\\"sql\\\": \\\"SELECT * FROM app_user WHERE email = 'test@example.com';\\\"}], \\\"error_explanations\\\": [{\\\"error_message\\\": \\\"ERROR:  relation \\\\\\\"users\\\\\\\" does not exist\\\", \\\"cause\\\": \\\"Wrong table name 'users'\\\", \\\"fix\\\": \\\"Use 'app_user' which is the actual table name\\\"}], \\\"explanations\\\": [], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"design_schema\\\", \\\"natural_language_task\\\": \\\"Add a waitlist feature for fully booked services\\\", \\\"current_schema\\\": \\\"CREATE TABLE service (service_id uuid PRIMARY KEY); CREATE TABLE app_user (user_id uuid PRIMARY KEY, tenant_id uuid); CREATE TABLE availability_slot (slot_id uuid PRIMARY KEY, service_id uuid REFERENCES service(service_id), tenant_id uuid);\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"postgres\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": false}, \\\"sql_snippets\\\": {}, \\\"error_message\\\": \\\"\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"design_schema\\\"], \\\"migrations\\\": [{\\\"filename\\\": \\\"001_add_waitlist_table.sql\\\", \\\"sql\\\": \\\"CREATE TABLE waitlist (waitlist_id SERIAL PRIMARY KEY, tenant_id uuid REFERENCES tenant(tenant_id), service_id uuid REFERENCES service(service_id), customer_id uuid REFERENCES app_user(user_id), requested_date date DEFAULT CURRENT_DATE, status text CHECK (status IN ('waiting', 'notified', 'cancelled')), created_at timestamptz DEFAULT now());\\\"}], \\\"rls_policies\\\": [], \\\"indexes\\\": [{\\\"sql\\\": \\\"CREATE INDEX idx_waitlist_service_tenant ON waitlist(service_id, tenant_id);\\\"}, {\\\"sql\\\": \\\"CREATE INDEX idx_waitlist_customer ON waitlist(customer_id);\\\"}], \\\"queries\\\": [{\\\"description\\\": \\\"Add user to waitlist\\\", \\\"sql\\\": \\\"INSERT INTO waitlist (tenant_id, service_id, customer_id) VALUES ($1, $2, $3) ON CONFLICT DO NOTHING;\\\"}], \\\"error_explanations\\\": [], \\\"explanations\\\": [\\\"Add waitlist table linked to services and customers\\\"], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"design_schema\\\", \\\"natural_language_task\\\": \\\"Add customer loyalty points system\\\", \\\"current_schema\\\": \\\"CREATE TABLE app_user (user_id uuid PRIMARY KEY, tenant_id uuid REFERENCES tenant(tenant_id)); CREATE TABLE booking (booking_id uuid PRIMARY KEY, tenant_id uuid, customer_id uuid REFERENCES app_user(user_id)); CREATE TABLE payment (payment_id uuid PRIMARY KEY, amount numeric(12,2));\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"postgres\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": false}, \\\"sql_snippets\\\": {}, \\\"error_message\\\": \\\"\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"design_schema\\\"], \\\"migrations\\\": [{\\\"filename\\\": \\\"002_add_loyalty_points.sql\\\", \\\"sql\\\": \\\"CREATE TABLE loyalty_points (loyalty_id SERIAL PRIMARY KEY, tenant_id uuid REFERENCES tenant(tenant_id), customer_id uuid REFERENCES app_user(user_id), points_earned integer DEFAULT 0, points_spent integer DEFAULT 0, expiry_date date DEFAULT (CURRENT_DATE + INTERVAL '1 year'), created_at timestamptz DEFAULT now()); ALTER TABLE booking ADD COLUMN points_awarded boolean DEFAULT false;\\\"}], \\\"rls_policies\\\": [], \\\"indexes\\\": [{\\\"sql\\\": \\\"CREATE INDEX idx_loyalty_customer ON loyalty_points(customer_id);\\\"}], \\\"queries\\\": [{\\\"description\\\": \\\"Award points for completed booking\\\", \\\"sql\\\": \\\"INSERT INTO loyalty_points (tenant_id, customer_id, points_earned) SELECT b.tenant_id, b.customer_id, FLOOR(p.amount / 10) FROM booking b JOIN payment p ON b.booking_id = p.booking_id WHERE b.status = 'completed' AND b.points_awarded = false; UPDATE booking SET points_awarded = true WHERE booking_id IN (SELECT booking_id FROM booking WHERE status = 'completed' AND points_awarded = false);\\\"}], \\\"error_explanations\\\": [], \\\"explanations\\\": [\\\"Add loyalty table and track points per customer\\\"], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"design_schema\\\", \\\"natural_language_task\\\": \\\"Add coupon/discount feature\\\", \\\"current_schema\\\": \\\"CREATE TABLE service (service_id uuid PRIMARY KEY, base_price numeric(12,2), tenant_id uuid); CREATE TABLE booking (booking_id uuid PRIMARY KEY, tenant_id uuid);\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"supabase\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": true}, \\\"sql_snippets\\\": {}, \\\"error_message\\\": \\\"\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"design_schema\\\"], \\\"migrations\\\": [{\\\"filename\\\": \\\"003_add_coupons.sql\\\", \\\"sql\\\": \\\"CREATE TABLE coupon (coupon_id uuid PRIMARY KEY, tenant_id uuid REFERENCES tenant(tenant_id), code text UNIQUE, discount_type text CHECK (discount_type IN ('percentage', 'fixed')), discount_value numeric(12,2), valid_from date DEFAULT CURRENT_DATE, valid_until date, max_uses integer, uses_count integer DEFAULT 0, is_active boolean DEFAULT true); ALTER TABLE booking ADD COLUMN coupon_id uuid REFERENCES coupon(coupon_id);\\\"}], \\\"rls_policies\\\": [], \\\"indexes\\\": [{\\\"sql\\\": \\\"CREATE INDEX idx_coupon_code ON coupon(code);\\\"}], \\\"queries\\\": [{\\\"description\\\": \\\"Apply coupon validation\\\", \\\"sql\\\": \\\"UPDATE coupon SET uses_count = uses_count + 1 WHERE coupon_id = $1 AND is_active = true AND CURRENT_DATE BETWEEN valid_from AND valid_until AND (max_uses IS NULL OR uses_count < max_uses);\\\"}], \\\"error_explanations\\\": [], \\\"explanations\\\": [\\\"Add flexible discount system with usage tracking\\\"], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"design_schema\\\", \\\"natural_language_task\\\": \\\"Add audit log for booking changes\\\", \\\"current_schema\\\": \\\"CREATE TABLE booking (booking_id uuid PRIMARY KEY, tenant_id uuid, status text); CREATE TABLE app_user (user_id uuid PRIMARY KEY);\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"postgres\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": false}, \\\"sql_snippets\\\": {}, \\\"error_message\\\": \\\"\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"design_schema\\\"], \\\"migrations\\\": [{\\\"filename\\\": \\\"004_add_audit_log.sql\\\", \\\"sql\\\": \\\"CREATE TABLE booking_audit (audit_id SERIAL PRIMARY KEY, booking_id uuid REFERENCES booking(booking_id), tenant_id uuid, changed_by_user_id uuid REFERENCES app_user(user_id), old_status text, new_status text, change_reason text, changed_at timestamptz DEFAULT now());\\\"}], \\\"rls_policies\\\": [], \\\"indexes\\\": [{\\\"sql\\\": \\\"CREATE INDEX idx_audit_booking ON booking_audit(booking_id);\\\"}, {\\\"sql\\\": \\\"CREATE INDEX idx_audit_tenant_time ON booking_audit(tenant_id, changed_at);\\\"}], \\\"queries\\\": [{\\\"description\\\": \\\"Log status change\\\", \\\"sql\\\": \\\"INSERT INTO booking_audit (booking_id, tenant_id, changed_by_user_id, old_status, new_status, change_reason) VALUES ($1, $2, $3, (SELECT status FROM booking WHERE booking_id = $1), $4, $5);\\\"}], \\\"error_explanations\\\": [], \\\"explanations\\\": [\\\"Audit table tracks all booking status changes\\\"], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"design_schema\\\", \\\"natural_language_task\\\": \\\"Add service reviews and ratings\\\", \\\"current_schema\\\": \\\"CREATE TABLE service (service_id uuid PRIMARY KEY, tenant_id uuid); CREATE TABLE app_user (user_id uuid PRIMARY KEY, tenant_id uuid); CREATE TABLE booking (booking_id uuid PRIMARY KEY, service_id uuid REFERENCES service(service_id), customer_id uuid REFERENCES app_user(user_id));\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"supabase\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": true}, \\\"sql_snippets\\\": {}, \\\"error_message\\\": \\\"\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"design_schema\\\"], \\\"migrations\\\": [{\\\"filename\\\": \\\"005_add_reviews_and_ratings.sql\\\", \\\"sql\\\": \\\"CREATE TABLE service_review (review_id uuid PRIMARY KEY DEFAULT gen_random_uuid(), service_id uuid REFERENCES service(service_id), tenant_id uuid NOT NULL, customer_id uuid REFERENCES app_user(user_id), booking_id uuid REFERENCES booking(booking_id), rating integer CHECK (rating >= 1 AND rating <= 5), title text, comment text, is_public boolean DEFAULT true, created_at timestamptz DEFAULT now()); ALTER TABLE service ADD COLUMN avg_rating numeric(2,1) DEFAULT 0, ADD COLUMN review_count integer DEFAULT 0;\\\"}], \\\"rls_policies\\\": [], \\\"indexes\\\": [{\\\"sql\\\": \\\"CREATE INDEX idx_review_service_rating ON service_review(service_id, rating);\\\"}, {\\\"sql\\\": \\\"CREATE INDEX idx_review_customer ON service_review(customer_id);\\\"}], \\\"queries\\\": [{\\\"description\\\": \\\"Calculate average rating\\\", \\\"sql\\\": \\\"UPDATE service SET avg_rating = (SELECT AVG(rating) FROM service_review WHERE service_id = $1 AND is_public = true), review_count = (SELECT COUNT(*) FROM service_review WHERE service_id = $1) WHERE service_id = $1;\\\"}], \\\"error_explanations\\\": [], \\\"explanations\\\": [\\\"Add review system with rating calculations\\\"], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"design_rls\\\", \\\"natural_language_task\\\": \\\"Tenants should only see their own data\\\", \\\"current_schema\\\": \\\"CREATE TABLE tenant (tenant_id uuid PRIMARY KEY); CREATE TABLE service (tenant_id uuid REFERENCES tenant); CREATE TABLE booking (tenant_id uuid REFERENCES tenant);\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"supabase\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": true}, \\\"sql_snippets\\\": {}, \\\"error_message\\\": \\\"\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"design_rls\\\"], \\\"migrations\\\": [], \\\"rls_policies\\\": [{\\\"on_table\\\": \\\"tenant\\\", \\\"policy_name\\\": \\\"tenant_self_read\\\", \\\"sql\\\": \\\"CREATE POLICY tenant_self_read ON tenant FOR SELECT USING (tenant_id = auth.uid());\\\"}, {\\\"on_table\\\": \\\"service\\\", \\\"policy_name\\\": \\\"service_tenant_isolation\\\", \\\"sql\\\": \\\"CREATE POLICY service_tenant_isolation ON service FOR ALL USING (tenant_id = auth.uid());\\\"}, {\\\"on_table\\\": \\\"booking\\\", \\\"policy_name\\\": \\\"booking_tenant_isolation\\\", \\\"sql\\\": \\\"CREATE POLICY booking_tenant_isolation ON booking FOR ALL USING (tenant_id = auth.uid());\\\"}], \\\"indexes\\\": [], \\\"queries\\\": [], \\\"error_explanations\\\": [], \\\"explanations\\\": [\\\"RLS policies ensure multi-tenant data isolation\\\"], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"design_rls\\\", \\\"natural_language_task\\\": \\\"Customers can only see their own bookings and payments\\\", \\\"current_schema\\\": \\\"CREATE TABLE app_user (user_id uuid PRIMARY KEY); CREATE TABLE booking (customer_id uuid REFERENCES app_user(user_id)); CREATE TABLE payment (booking_id uuid);\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"supabase\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": true}, \\\"sql_snippets\\\": {}, \\\"error_message\\\": \\\"\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"design_rls\\\"], \\\"migrations\\\": [], \\\"rls_policies\\\": [{\\\"on_table\\\": \\\"booking\\\", \\\"policy_name\\\": \\\"customer_booking_access\\\", \\\"sql\\\": \\\"CREATE POLICY customer_booking_access ON booking FOR SELECT USING (customer_id = auth.uid());\\\"}, {\\\"on_table\\\": \\\"payment\\\", \\\"policy_name\\\": \\\"customer_payment_access\\\", \\\"sql\\\": \\\"CREATE POLICY customer_payment_access ON payment FOR SELECT USING (booking_id IN (SELECT b.booking_id FROM booking b WHERE b.customer_id = auth.uid()));\\\"}], \\\"indexes\\\": [], \\\"queries\\\": [], \\\"error_explanations\\\": [], \\\"explanations\\\": [\\\"Restrict customers to their own transactional data\\\"], \\\"safe_to_execute\\\": true}\""}
{"prompt": "SYSTEM:\nSQL Micro-Brain v0 – BookWise training example\n\nUSER_JSON:\n\"{\\\"mode\\\": \\\"design_rls\\\", \\\"natural_language_task\\\": \\\"Staff can see all data in their tenant, but only modify bookings assigned to them\\\", \\\"current_schema\\\": \\\"CREATE TABLE app_user (user_id uuid PRIMARY KEY, role text, tenant_id uuid); CREATE TABLE booking (tenant_id uuid, customer_id uuid, staff_id uuid REFERENCES app_user(user_id));\\\", \\\"preferences\\\": {\\\"db_engine\\\": \\\"supabase\\\", \\\"naming\\\": \\\"snake_case\\\", \\\"supabase_style\\\": true}, \\\"sql_snippets\\\": {}, \\\"error_message\\\": \\\"\\\"}\"\n\nASSISTANT_JSON:\n", "completion": "\"{\\\"actions\\\": [\\\"design_rls\\\"], \\\"migrations\\\": [], \\\"rls_policies\\\": [{\\\"on_table\\\": \\\"booking\\\", \\\"policy_name\\\": \\\"staff_tenant_read\\\", \\\"sql\\\": \\\"CREATE POLICY staff_tenant_read ON booking FOR SELECT USING (tenant_id = (SELECT tenant_id FROM app_user WHERE user_id = auth.uid()));\\\"}, {\\\"on_table\\\": \\\"booking\\\", \\\"policy_name\\\": \\\"staff_own_write\\\", \\\"sql\\\": \\\"CREATE POLICY staff_own_write ON booking FOR UPDATE USING (staff_id = auth.uid());\\\"}], \\\"indexes\\\": [], \\\"queries\\\": [], \\\"error_explanations\\\": [], \\\"explanations\\\": [\\\"Different policies for reading all tenant data vs writing only assigned items\\\"], \\\"safe_to_execute\\\": true}\""}
