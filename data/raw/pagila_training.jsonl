{"system": "SQL Micro-Brain v0 – Pagila training example", "user": {"mode": "write_sql", "natural_language_task": "List all films with their category and the total number of rentals for each.", "current_schema": "CREATE TABLE film (film_id integer PRIMARY KEY, title varchar); CREATE TABLE film_category (film_id integer REFERENCES film, category_id integer); CREATE TABLE category (category_id integer PRIMARY KEY, name varchar); CREATE TABLE inventory (inventory_id integer PRIMARY KEY, film_id integer REFERENCES film); CREATE TABLE rental (rental_id integer PRIMARY KEY, inventory_id integer REFERENCES inventory);", "preferences": {"db_engine": "postgres", "naming": "snake_case", "supabase_style": false}, "sql_snippets": {}, "error_message": ""}, "assistant": {"actions": ["write_sql"], "migrations": [], "rls_policies": [], "indexes": [], "queries": [{"description": "Retrieve films with category and rental counts", "sql": "SELECT f.title, c.name AS category, COUNT(r.rental_id) AS total_rentals FROM film f JOIN film_category fc ON f.film_id = fc.film_id JOIN category c ON fc.category_id = c.category_id LEFT JOIN inventory i ON f.film_id = i.film_id LEFT JOIN rental r ON i.inventory_id = r.inventory_id GROUP BY f.film_id, c.category_id ORDER BY total_rentals DESC;"}], "error_explanations": [], "explanations": ["Join film to category via film_category, then to rentals via inventory. Use LEFT JOIN and GROUP BY to count rentals per film."], "safe_to_execute": true}}
{"system": "SQL Micro-Brain v0 – Pagila training example", "user": {"mode": "optimize_query", "natural_language_task": "Optimize this query for better performance.", "current_schema": "", "preferences": {"db_engine": "postgres", "naming": "snake_case", "supabase_style": false}, "sql_snippets": {"problem_query": "SELECT f.title, COUNT(r.rental_id) FROM film f, inventory i, rental r WHERE f.film_id = i.film_id AND i.inventory_id = r.inventory_id GROUP BY f.film_id;", "explain_analyze": ""}, "error_message": ""}, "assistant": {"actions": ["optimize_query"], "migrations": [], "rls_policies": [], "indexes": [{"sql": "CREATE INDEX idx_inventory_film_id ON inventory(film_id);"}, {"sql": "CREATE INDEX idx_rental_inventory_id ON rental(inventory_id);"}], "queries": [{"description": "Optimized rental count query", "sql": "SELECT f.title, COUNT(r.rental_id) FROM film f JOIN inventory i ON f.film_id = i.film_id JOIN rental r ON i.inventory_id = r.inventory_id GROUP BY f.film_id, f.title;"}], "error_explanations": [], "explanations": ["Replace implicit JOIN with explicit JOIN for clarity. Add indexes on foreign keys to speed up joins."], "safe_to_execute": true}}
{"system": "SQL Micro-Brain v0 – Pagila training example", "user": {"mode": "fix_error", "natural_language_task": "Fix column name error.", "current_schema": "", "preferences": {"db_engine": "postgres", "naming": "snake_case", "supabase_style": false}, "sql_snippets": {"problem_query": "SELECT c.first_name, c.last_nme, SUM(p.amount) FROM customer c JOIN payment p ON c.customer_id = p.customer_id GROUP BY c.customer_id;", "explain_analyze": ""}, "error_message": "ERROR:  column c.last_nme does not exist\\nLINE 1: ...lect c.first_name, c.last_nme, SUM(p.amount) FROM customer c ..."}, "assistant": {"actions": ["fix_error"], "migrations": [], "rls_policies": [], "indexes": [], "queries": [{"description": "Correct column name", "sql": "SELECT c.first_name, c.last_name, SUM(p.amount) FROM customer c JOIN payment p ON c.customer_id = p.customer_id GROUP BY c.customer_id;"}], "error_explanations": [{"error_message": "ERROR:  column c.last_nme does not exist\\nLINE 1: ...lect c.first_name, c.last_nme, SUM(p.amount) FROM customer c ...", "cause": "Typo in column name 'last_nme' instead of 'last_name'", "fix": "Change 'last_nme' to 'last_name'"}], "explanations": [], "safe_to_execute": true}}
{"system": "SQL Micro-Brain v0 – Pagila training example", "user": {"mode": "design_schema", "natural_language_task": "Add a loyalty points system for customers.", "current_schema": "CREATE TABLE customer (customer_id integer PRIMARY KEY, first_name varchar, last_name varchar);", "preferences": {"db_engine": "postgres", "naming": "snake_case", "supabase_style": false}, "sql_snippets": {}, "error_message": ""}, "assistant": {"actions": ["design_schema"], "migrations": [{"filename": "001_add_loyalty_points_table.sql", "sql": "CREATE TABLE loyalty_points (id SERIAL PRIMARY KEY, customer_id integer REFERENCES customer(customer_id), points integer DEFAULT 0, earned_date date DEFAULT CURRENT_DATE);"}], "rls_policies": [], "indexes": [{"sql": "CREATE INDEX idx_loyalty_customer_id ON loyalty_points(customer_id);"}], "queries": [{"description": "Award loyalty points for rentals", "sql": "INSERT INTO loyalty_points (customer_id, points) SELECT r.customer_id, COUNT(*) * 10 FROM rental r WHERE r.return_date IS NOT NULL AND r.return_date >= CURRENT_DATE - INTERVAL '1 month' GROUP BY r.customer_id;"}], "error_explanations": [], "explanations": ["Add points table linked to customers, with example query to award based on recent rentals."], "safe_to_execute": true}}
{"system": "SQL Micro-Brain v0 – Pagila training example", "user": {"mode": "design_rls", "natural_language_task": "Staff should only see rentals from their own store.", "current_schema": "CREATE TABLE rental (rental_id integer PRIMARY KEY, inventory_id integer); CREATE TABLE staff (staff_id integer PRIMARY KEY, store_id integer);", "preferences": {"db_engine": "supabase", "supabase_style": true}, "sql_snippets": {}, "error_message": ""}, "assistant": {"actions": ["design_rls"], "migrations": [], "rls_policies": [{"on_table": "rental", "policy_name": "staff_store_isolation", "sql": "CREATE POLICY staff_store_isolation ON rental FOR ALL USING (inventory_id IN (SELECT inventory_id FROM inventory WHERE store_id = (SELECT store_id FROM staff WHERE staff_id = auth.uid())));"}], "indexes": [], "queries": [], "error_explanations": [], "explanations": ["Use RLS to restrict rentals to those in staff's store via inventory."], "safe_to_execute": true}}
