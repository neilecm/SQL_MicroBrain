{"input":{"mode":"design_schema","natural_language_task":"Design schema for BookWise: books, users, reviews, with multi-tenant.","preferences":{"supabase_style":true,"naming":"snake_case","id_type":"uuid","multi_tenant":true}},"output":{"actions":["create_tables","create_indexes","create_rls"],"migrations":[{"filename":"001_create_books.sql","sql":"CREATE TABLE books (id UUID PRIMARY KEY, title TEXT, tenant_id UUID); CREATE TABLE users (id UUID PRIMARY KEY, email TEXT UNIQUE); CREATE TABLE reviews (id UUID PRIMARY KEY, book_id UUID REFERENCES books, user_id UUID REFERENCES users, rating INTEGER, tenant_id UUID);"}],"rls_policies":[{"on_table":"books","policy_name":"tenant_books","sql":"CREATE POLICY tenant_books ON books FOR ALL USING (tenant_id IN (SELECT tenant_id FROM users WHERE id = auth.uid()));"}],"indexes":[{"sql":"CREATE INDEX ON reviews(book_id);"}],"queries":[],"error_explanations":[],"explanations":["Included tenant_id in tables for multi-tenancy."],"safe_to_execute":true}}
{"input":{"mode":"write_sql","natural_language_task":"Insert a new review for a book.","current_schema":"CREATE TABLE reviews (id UUID PRIMARY KEY, book_id UUID, user_id UUID, rating INTEGER);"},"output":{"actions":[],"migrations":[],"rls_policies":[],"indexes":[],"queries":[{"description":"Add a new review","sql":"INSERT INTO reviews (id, book_id, user_id, rating) VALUES (gen_random_uuid(), 'some-book-id', 'some-user-id', 5);"}],"error_explanations":[],"explanations":[],"safe_to_execute":false}}
{"input":{"mode":"fix_error","error_message":"Relation 'reviews' does not exist.","sql_snippets":{"problem_query":"SELECT * FROM reviews;"}},"output":{"actions":[],"migrations":[{"filename":"fix_reviews.sql","sql":"CREATE TABLE reviews (id UUID PRIMARY KEY, book_id UUID, user_id UUID, rating INTEGER);"}],"rls_policies":[],"indexes":[],"queries":[],"error_explanations":[{"error_message":"Relation 'reviews' does not exist.","cause":"Table reviews was not created.","fix":"Created the table in migration."}],"explanations":[],"safe_to_execute":true}}
